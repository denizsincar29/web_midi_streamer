<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>Web MIDI Streamer</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>Web MIDI Streamer</h1>
            <p>Real-time MIDI streaming over WebRTC</p>
        </header>

        <main>
            <!-- Room Information -->
            <section class="room-info">
                <h2>Status: <span id="roomName">Not connected</span></h2>
                <div class="status-container">
                    <span class="status-indicator" id="statusIndicator" aria-hidden="true"></span>
                    <span id="connectionStatus">Disconnected</span>
                </div>
            </section>
            
            <!-- Screen Reader Status Bar -->
            <div id="statusBar" class="sr-only" role="status" aria-live="polite" aria-atomic="false"></div>

            <!-- MIDI Devices -->
            <section class="midi-devices">
                <h2>MIDI Devices</h2>
                
                <div class="device-group">
                    <label for="midiInput">Input Device:</label>
                    <select id="midiInput" aria-label="Select MIDI input device">
                        <option value="">No device selected</option>
                    </select>
                </div>

                <div class="device-group">
                    <label for="midiOutput">Output Device:</label>
                    <select id="midiOutput" aria-label="Select MIDI output device">
                        <option value="">No device selected</option>
                    </select>
                </div>

                <button id="refreshDevices" class="btn btn-secondary">Refresh Devices</button>
            </section>

            <!-- Connection Controls -->
            <section class="controls">
                <h2>Connection</h2>
                <button id="connectBtn" class="btn btn-primary">Connect to Room</button>
                <button id="disconnectBtn" class="btn btn-danger" disabled>Disconnect</button>
            </section>

            <!-- Advanced Tools -->
            <details class="advanced">
                <summary><h2>Advanced</h2></summary>
                <div class="advanced-content">
                    <h3>Settings</h3>
                    
                    <div class="setting-group">
                        <label>
                            <input type="checkbox" id="sysexEnabled" aria-describedby="sysex-desc">
                            Enable SysEx Support
                        </label>
                        <p id="sysex-desc" class="description">Allow System Exclusive messages (required for advanced keyboard features)</p>
                    </div>

                    <div class="setting-group">
                        <label>
                            <input type="checkbox" id="timestampEnabled" aria-describedby="timestamp-desc">
                            Enable Timestamp Sync (Experimental)
                        </label>
                        <p id="timestamp-desc" class="description">Send MIDI data with timestamps for better timing on slow connections</p>
                    </div>

                    <div class="setting-group">
                        <label>
                            <input type="checkbox" id="audioFeedbackEnabled" aria-describedby="audio-desc">
                            Enable Audio Feedback
                        </label>
                        <p id="audio-desc" class="description">Hear announcements of MIDI events (accessibility feature)</p>
                    </div>

                    <div class="setting-group">
                        <label>
                            <input type="checkbox" id="showMidiActivity" aria-describedby="midi-activity-desc">
                            Show MIDI Activity
                        </label>
                        <p id="midi-activity-desc" class="description">Display and announce MIDI events via screen reader</p>
                    </div>
                    
                    <h3>Debug Tools</h3>
                    <button id="sendTestNoteBtn" class="btn btn-secondary" disabled>Send Test Note (C4)</button>
                    <button id="sendPingBtn" class="btn btn-secondary" disabled>Send Ping</button>
                    <label>
                        <input type="checkbox" id="midiEchoEnabled">
                        MIDI Echo (send back all received MIDI)
                    </label>
                    <p class="description">Test WebRTC data channel connectivity and MIDI echo</p>
                    
                    <h3>Messages</h3>
                    <div id="messageLog" role="log" aria-live="polite" aria-atomic="false"></div>
                </div>
            </details>

            <!-- MIDI Activity (for accessibility) -->
            <div id="midiActivity" role="status" aria-atomic="true" class="sr-only" aria-live="off"></div>
        </main>

        <footer>
            <p>Instructions: Click "Connect to Room" to generate a shareable link for peer-to-peer connection</p>
        </footer>
    </div>
    
    <script type="module">
        import './src/main.js';
    </script>
</body>
</html>
